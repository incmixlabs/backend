CREATE SCHEMA BASE;
CREATE SCHEMA INCMIX;

CREATE DOMAIN BASE.VALID_EMAIL AS CITEXT NULL CHECK (VALUE ~* ('^[A-Za-z0-9._%-]+@[A-Za-z0-9.-]+[.][A-Za-z]+$')
    OR VALUE IS NULL) NULL;

CREATE DOMAIN BASE.VALID_URL AS CITEXT NULL
    CHECK (VALUE ~ ('http|https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,255}\.[a-z]{2,9}\y([-a-zA-Z0-9@:%_\+.,~#?!&>//=]*)$')
    OR VALUE IS NULL) NULL;
CREATE DOMAIN BASE.VALID_EMAIL_OR_URL AS CITEXT NULL
    CHECK (VALUE ~* ('^[A-Za-z0-9._%-]+@[A-Za-z0-9.-]+[.][A-Za-z]+$')
    OR VALUE ~ ('http|https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,255}\.[a-z]{2,9}\y([-a-zA-Z0-9@:%_\+.,~#?!&>//=]*)$')
    OR VALUE IS NULL) NULL;
CREATE DOMAIN BASE.VALID_HANDLE AS VARCHAR(25)
    NOT NULL
    CHECK (VALUE ~* '^[A-Za-z0-9._\-]+$');
;
CREATE DOMAIN BASE.VALID_COL_NAME AS VARCHAR(100)
    NOT NULL
    CHECK (VALUE ~* '^[A-Za-z0-9_]+$');

CREATE DOMAIN BASE.VALID_HANDLE2 AS VARCHAR(30)
    NOT NULL
    CHECK (VALUE ~* '^[A-ZA-Z0-9._%-]+$') ;

CREATE TYPE BASE.OAUTH_ENUM AS ENUM('GOOGLE');
CREATE DOMAIN BASE.DATE_OF_BIRTH AS DATE
	CHECK (VALUE > '1900-01-01'::DATE);

CREATE DOMAIN BASE.VALID_PHONE AS TEXT
    CHECK (VALUE ~* '^[0-9]{10}$');

CREATE DOMAIN BASE.VALID_PASSWORD AS TEXT
    NOT NULL
    CHECK (VALUE ~* '^(?=.*[A-Z])(?=.*[A-Z])(?=.*[0-9]).{8,}$');

CREATE DOMAIN BASE.US_POSTAL_CODE AS TEXT
CHECK(
   VALUE ~ '^\D{5}$'
OR VALUE ~ '^\D{5}-\D{4}$'
);
CREATE TYPE BASE.VALID_ZONE AS ENUM('US-E', 'US-W', 'EU', 'ASIA', 'UK');
CREATE TYPE BASE.VALID_ROLE AS ENUM('OWNER', 'ADMIN', 'EDITOR', 'USER','REVIEWER', 'MEMBER', 'GUEST', 'UNKNOWN');
CREATE TYPE BASE.COLAB_ROLE AS ENUM('MEMBER', 'REVIEWER', 'ADMIN', 'GUEST', 'UNKNOWN');
CREATE TYPE BASE.UPDATE_TYPE AS ENUM('I', 'U', 'D');

-- YOU NEVER RETURN ID TO THE CLIENT .. SINCE IT'S SEQUENTIAL AND CAN BE GUESSED
-- YOU ALWAYS RETURN UUID TO THE CLIENT
CREATE DOMAIN BASE.MMN_TYPE AS CHAR(3);
CREATE DOMAIN BASE.NOTES_TYPE AS TEXT;
CREATE TYPE BASE.DATE_RANGE_TYPE AS (START_DATE TIMESTAMPTZ, END_DATE TIMESTAMPTZ);
CREATE DOMAIN BASE.TAGS_TYPE AS TEXT[];
CREATE DOMAIN BASE.TINYINT AS SMALLINT;
CREATE DOMAIN BASE.LOV_TYPE AS BASE.TINYINT;
-- CATEGORY
CREATE DOMAIN BASE.NAME_TYPE VARCHAR(100);
CREATE TYPE BASE.COL_DEF_ENUM AS ENUM('DATE_RANGE', 'DATE', 'TAGS', 'TEXT', 'NUMBER', 'BOOLEAN', 'LOV', 'CAT','UUID', 'EMAIL', 'PHONE', 'URL', 'HANDLE',  'PASSWORD', 'NOTES', 'JSON', 'JSONB', 'ARRAY', 'ARRAY_JSON', 'ARRAY_JSONB', 'ARRAY_TEXT', 'ARRAY_NUMBER', 'ARRAY_BOOLEAN', 'ARRAY_ENUM', 'ARRAY_LOV',  'ARRAY_EMAIL', 'ARRAY_PHONE', 'ARRAY_URL');
-- OB - OWNED BY, PC - PARENT-CHILD, PP - PEER-PEER, EXTEND-PARENT,CLONED-OBJECT, LINKED-OBJECT, ROOT-OBJECT, RELATED, REPLACED-OBJECT
CREATE TYPE BASE.RELATION_TYPE AS ENUM('OB', 'PC', 'PP', 'EP', 'CO', 'LO', 'RO', 'RL', 'RP');
CREATE TYPE BASE.FILE_TYPE AS ENUM('.png', '.gif', '.mp4', '.txt', '.pdf');
CREATE TYPE BASE.FILE_UNIT AS ENUM ('B','KB','MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB');
CREATE TYPE BASE.JOB_STATUS_TYPE AS ENUM('IN PROGRESS', 'COMPLETED', 'ABORTED', 'SCHEDULED', 'CANCELLED');
CREATE TYPE BASE.FREQ_TYPE AS ENUM('1MIN', '5MIN', '10MIN', '15MIN', '30MIN', 'HOURLY','4HOURS', '8HOURS', 'DAILY', 'MIDNIGHTLY', 'WEEKLY', 'MONTHLY', 'QUARTERLY', 'YEARLY');
CREATE TYPE BASE.WORKSPACE_VISIBILITY_OPTION AS ENUM('EXTERNAL', 'INTERNAL', 'BOTH', 'VENDOR-PARTNERS');
CREATE TYPE BASE.WORKSPACE_INVITE_OPTION AS ENUM('AUTO', 'AUTO-WHITE-LIST', 'AUTO-BLACK-LIST');
-- NH 0 - external facing
-- NH 1 - external facing - restricted (partner portals)
-- NH 2 - internal facing
-- NH 3 - internal facing - restricted
CREATE TYPE BASE.NH_LEVEL_TYPE AS ENUM('0','1','2','3');
CREATE TYPE BASE.ORG_PLAN_TYPE AS ENUM('FREE', 'BASIC', 'PRO', 'ENTERPRISE');
CREATE TYPE BASE.SESSION_LOGOUT_TYPE AS ENUM('LOGOUT', 'EXPIRE', 'REVOKE');
CREATE TYPE BASE.AGREE_TYPE AS ENUM('PRIVACY POLICY', 'TERMS OF SERVICE', 'DISCLAIMER');
CREATE TYPE BASE.PROJECT_STATUS_TYPE AS ENUM('OPEN', 'CANCELLED', 'CLOSED', 'COMPLETED', 'ARCHIVED', 'MOVED', 'STALLED');
CREATE TYPE BASE.PROJECT_TYPE AS ENUM('AGILE', 'WATERFALL');
CREATE TYPE BASE.TIME_TYPE AS ENUM ('day' , 'days' , 'week' , 'month' , 'year');
CREATE TYPE BASE.address AS (
        street text,
        city text,
        state text,
        country text,
        postal_code text,
        lat double precision,
        lon double precision
);
create type BASE.DATE_RANGE AS (
    FROM_DATE TIMESTAMPTZ,
    TO_DATE TIMESTAMPTZ
);

CREATE Type BASE.STATUS AS (
    IS_ACT BOOLEAN, -- IS ACTIVE
    IS_DEL BOOLEAN
);

create type BASE.FINANCIALS AS (
   ACTUAL INT,
   BUDGET INT
);

CREATE TYPE BASE.CELL_DEF AS (
    TYP   BASE.COL_DEF_ENUM,
    VALIDATION JSON,
    FORMT JSON,
    DEFLT TEXT,
    NULLABLE BOOLEAN,
    READONLY BOOLEAN
);
CREATE TYPE BASE.LOCATION AS (
    ADDRESS BASE.ADDRESS,
    LATITUDE DOUBLE PRECISION,
    LONGITUDE DOUBLE PRECISION
);
