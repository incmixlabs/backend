CREATE SCHEMA INCMIX;

CREATE DOMAIN INCMIX.VALID_EMAIL AS CITEXT
    NOT NULL CHECK ( value ~ '^[a-zA-Z0-9.!#$%&''*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$' );
;
CREATE DOMAIN INCMIX.VALID_EMAIL AS CITEXT NULL CHECK (VALUE ~* ('^[A-Za-z0-9._%-]+@[A-Za-z0-9.-]+[.][A-Za-z]+$')
    OR VALUE IS NULL) NULL;

CREATE DOMAIN INCMIX.VALID_URL AS CITEXT NULL
    CHECK (VALUE ~ ('http|https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,255}\.[a-z]{2,9}\y([-a-zA-Z0-9@:%_\+.,~#?!&>//=]*)$')
    OR VALUE IS NULL) NULL;

CREATE DOMAIN INCMIX.VALID_HANDLE AS VARCHAR(25)
    NOT NULL
    CHECK (VALUE ~* '^[A-Za-z0-9._\-]+$');
;
CREATE DOMAIN INCMIX.VALID_COL_NAME AS VARCHAR(100)
    NOT NULL
    CHECK (VALUE ~* '^[A-Za-z0-9_]+$');

CREATE DOMAIN INCMIX.VALID_HANDLE2 AS VARCHAR(30)
    NOT NULL
    CHECK (VALUE ~* '^[A-ZA-Z0-9._%-]+$') ;

CREATE TYPE INCMIX.OAUTH_ENUM AS ENUM('GOOGLE');
CREATE DOMAIN INCMIX.DATE_OF_BIRTH AS DATE
	CHECK (VALUE > '1900-01-01'::DATE);

CREATE DOMAIN INCMIX.VALID_PHONE AS TEXT
    CHECK (VALUE ~* '^[0-9]{10}$');

CREATE DOMAIN INCMIX.VALID_PASSWORD AS TEXT
    NOT NULL
    CHECK (VALUE ~* '^(?=.*[A-Z])(?=.*[A-Z])(?=.*[0-9]).{8,}$');

CREATE DOMAIN INCMIX.US_POSTAL_CODE AS TEXT
CHECK(
   VALUE ~ '^\D{5}$'
OR VALUE ~ '^\D{5}-\D{4}$'
);
CREATE TYPE INCMIX.VALID_ZONE AS ENUM('US-E', 'US-W', 'EU', 'ASIA', 'UK');
CREATE TYPE INCMIX.VALID_ROLE AS ENUM('OWNER', 'ADMIN', 'EDITOR', 'USER','REVIEWER', 'MEMBER', 'GUEST', 'UNKNOWN');
CREATE TYPE INCMIX.COLAB_ROLE AS ENUM('MEMBER', 'REVIEWER', 'ADMIN', 'GUEST', 'UNKNOWN');
CREATE TYPE INCMIX.UPDATE_TYPE AS ENUM('I', 'U', 'D');
CREATE DOMAIN INCMIX.VALID_UUID AS TEXT
    NOT NULL
    CHECK (VALUE ~* '^[A-ZA-Z0-9]{8}-[A-ZA-Z0-9]{4}-[A-ZA-Z0-9]{4}-[A-ZA-Z0-9]{4}-[A-ZA-Z0-9]{12}$');

-- YOU NEVER RETURN ID TO THE CLIENT .. SINCE IT'S SEQUENTIAL AND CAN BE GUESSED
-- YOU ALWAYS RETURN UUID TO THE CLIENT
CREATE DOMAIN INCMIX.MMN_TYPE AS CHAR(3);
CREATE DOMAIN INCMIX.NOTES_TYPE AS TEXT;
CREATE TYPE INCMIX.DATE_RANGE_TYPE AS (START_DATE TIMESTAMPTZ, END_DATE TIMESTAMPTZ);
CREATE DOMAIN INCMIX.TAGS_TYPE AS TEXT[];
CREATE DOMAIN INCMIX.TINYINT AS SMALLINT;
CREATE DOMAIN INCMIX.LOV_TYPE AS INCMIX.TINYINT;
-- CATEGORY
CREATE DOMAIN INCMIX.NAME_TYPE VARCHAR(100);
CREATE TYPE INCMIX.COL_DEF_ENUM AS ENUM('DATE_RANGE', 'DATE', 'TAGS', 'TEXT', 'NUMBER', 'BOOLEAN', 'LOV', 'CAT','UUID', 'EMAIL', 'PHONE', 'URL', 'HANDLE',  'PASSWORD', 'NOTES', 'JSON', 'JSONB', 'ARRAY', 'ARRAY_JSON', 'ARRAY_JSONB', 'ARRAY_TEXT', 'ARRAY_NUMBER', 'ARRAY_BOOLEAN', 'ARRAY_ENUM', 'ARRAY_LOV',  'ARRAY_EMAIL', 'ARRAY_PHONE', 'ARRAY_URL');
-- PC - PARENT-CHILD, PP - PEER-PEER, EXTEND-PARENT,CLONED-OBJECT, LINKED-OBJECT, ROOT-OBJECT, RELATED, REPLACED-OBJECT
CREATE TYPE INCMIX.RELATION_TYPE AS ENUM('PC', 'PP', 'EP', 'CO', 'LO', 'RO', 'RL');
CREATE TYPE INCMIX.FILE_UNIT AS ENUM ('B','KB','MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB');
CREATE TYPE INCMIX.JOB_STATUS_TYPE AS ENUM('IN PROGRESS', 'COMPLETED', 'ABORTED', 'SCHEDULED', 'CANCELLED');
CREATE TYPE INCMIX.FREQ_TYPE AS ENUM('1MIN', '5MIN', '10MIN', '15MIN', '30MIN', 'HOURLY','4HOURS', '8HOURS', 'DAILY', 'MIDNIGHTLY', 'WEEKLY', 'MONTHLY', 'QUARTERLY', 'YEARLY');
CREATE TYPE INCMIX.WORKSPACE_VISIBILITY_OPTION AS ENUM('EXTERNAL', 'INTERNAL', 'BOTH', 'VENDOR-PARTNERS');
CREATE TYPE INCMIX.WORKSPACE_INVITE_OPTION AS ENUM('AUTO', 'AUTO-WHITE-LIST', 'AUTO-BLACK-LIST');
-- NH 0 - external facing
-- NH 1 - external facing - restricted (partner portals)
-- NH 2 - internal facing
-- NH 3 - internal facing - restricted
CREATE TYPE INCMIX.NH_LEVEL_TYPE AS ENUM('0','1','2','3');
CREATE TYPE INCMIX.ORG_PLAN_TYPE AS ENUM('FREE', 'BASIC', 'PRO', 'ENTERPRISE');
CREATE TYPE INCMIX.SESSION_LOGOUT AS ENUM('LOGOUT', 'EXPIRE', 'REVOKE');
CREATE TYPE INCMIX.AGREE_TYPE AS ENUM('PRIVACY POLICY', 'TERMS OF SERVICE', 'DISCLAIMER');
CREATE TYPE INCMIX.PROJECT_STATUS_TYPE AS ENUM('OPEN', 'CANCELLED', 'CLOSED', 'COMPLETED', 'ARCHIVED', 'MOVED', 'STALLED');
CREATE TYPE INCMIX.PROJECT_TYPE AS ENUM('AGILE', 'WATERFALL');
CREATE TYPE INCMIX.address AS (
        street text,
        city text,
        state text,
        country text,
        postal_code text,
        lat double precision,
        lon double precision
);
create type INCMIX.START_END_DATE AS (
    START_DATE TIMESTAMPTZ,
    END_DATE TIMESTAMPTZ
);

create type INCMIX.FINANCIALS AS (
   ACTUAL INT,
   BUDGET INT
);
